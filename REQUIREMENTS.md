# Dragon Game - 要件定義書

## プロジェクト概要
2Dプラットフォーマーゲーム「Dragon Game」の開発要件定義書です。プレイヤーは赤いドラゴンを操作し、3つのステージ（森、洞窟、城）を進んでいきます。

## 技術要件

### フレームワーク・ライブラリ
- **ゲームエンジン**: Phaser 3.90.0
- **UIフレームワーク**: React 19.1.0
- **言語**: TypeScript 5.0+
- **ビルドツール**: Vite
- **パッケージマネージャー**: npm

### 開発環境設定
```json
{
  "dependencies": {
    "phaser": "^3.90.0",
    "react": "^19.1.0",
    "react-dom": "^19.1.0"
  },
  "devDependencies": {
    "@types/react": "^19.1.9",
    "@types/react-dom": "^19.1.4",
    "@typescript-eslint/eslint-plugin": "^8.6.0",
    "@typescript-eslint/parser": "^8.6.0",
    "@vitejs/plugin-react": "^4.3.4",
    "eslint": "^9.11.0",
    "eslint-plugin-react-hooks": "^5.1.0",
    "eslint-plugin-react-refresh": "^0.4.12",
    "typescript": "^5.6.3",
    "vite": "^6.0.5"
  }
}
```

## ゲーム仕様

### 基本設定
- **解像度**: 800x600ピクセル
- **レンダラー**: WebGL（ピクセルアート設定）
- **物理エンジン**: Arcade Physics（重力: 800）
- **背景色**: スカイブルー（#87CEEB）
- **スケーリング**: FIT モード（中央配置）

### ゲームプレイ要素

#### プレイヤー仕様
- **キャラクター**: 赤いドラゴン
- **移動速度**: 160
- **ジャンプ力**: -400
- **ダブルジャンプ**: 可能（maxJumps: 2）
- **ライフ**: 3つ
- **無敵時間**: ダメージ後2秒間
- **アニメーション**: idle, run (2フレーム), jump

#### 敵キャラクター仕様
1. **スライム** (enemy-slime)
   - 移動速度: 50
   - 地上を左右に巡回

2. **コウモリ** (enemy-bat)
   - 移動速度: 80
   - 空中を左右に巡回

3. **スパイク** (enemy-spike)
   - 移動速度: 100
   - 地上を高速で左右に巡回

#### アイテム仕様
1. **コイン**
   - スコア: 10点
   - 上下に浮遊アニメーション

2. **パワーアップ**
   - スコア: 50点
   - 一時的な無敵効果（ステージ3のみ）

### ステージ構成

#### ステージ1: 森 (Forest)
- **ワールド幅**: 2400px
- **背景**: 森の背景（パララックススクロール）
- **特徴**: 基本的なプラットフォーム、穴、敵配置
- **敵数**: 9体（スライム、コウモリ混在）
- **コイン数**: 17個

#### ステージ2: 洞窟 (Cave)
- **ワールド幅**: 3000px
- **背景**: 洞窟の背景
- **特徴**: 動くプラットフォーム導入
- **動くプラットフォーム**: 3つ（水平・垂直移動）
- **敵数**: 12体
- **コイン数**: 20個

#### ステージ3: 城 (Castle)
- **ワールド幅**: 3600px
- **背景**: 城の背景
- **特徴**: スパイクトラップ、複雑な動くプラットフォーム
- **動くプラットフォーム**: 5つ（様々な移動パターン）
- **敵数**: 15体
- **コイン数**: 25個
- **パワーアップ**: 2個

### UI要件

#### HUD表示
- **スコア表示**: 左上（白文字、黒縁取り）
- **ライフ表示**: スコアの下
- **ステージ名**: 左上（ステージ開始時）

#### タッチコントロール（モバイル対応）
- **左ボタン**: 左移動
- **右ボタン**: 右移動
- **ジャンプボタン**: ジャンプ/ダブルジャンプ
- **透明度**: 0.5
- **押下時**: 透明度0.8

### シーン構成

1. **PreloadScene**
   - アセット読み込み
   - プログレスバー表示
   - 画像透過処理（白色を透明化）

2. **MenuScene**
   - タイトル画面
   - ゲーム開始ボタン
   - 操作説明

3. **Stage1Scene, Stage2Scene, Stage3Scene**
   - 各ステージのゲームプレイ
   - プレイヤー、敵、アイテム管理
   - 衝突判定処理

4. **UIScene**
   - HUD表示（常時オーバーレイ）
   - タッチコントロール表示

5. **GameOverScene**
   - ゲームオーバー画面
   - 最終スコア表示
   - リトライボタン

### アセット要件

#### 必要な画像ファイル
```
/public/assets/
├── sprites/
│   ├── player-idle.png
│   ├── player-run-1.png
│   ├── player-run-2.png
│   ├── player-jump.png
│   ├── enemy-slime.png
│   ├── enemy-bat.png
│   └── enemy-spike.png
├── tiles/
│   ├── ground.png
│   ├── brick.png
│   ├── platform.png
│   └── spike.png
├── items/
│   ├── coin.png
│   └── powerup.png
├── backgrounds/
│   ├── bg-forest.png
│   ├── bg-cave.png
│   └── bg-castle.png
└── ui/
    ├── button-left.png
    ├── button-right.png
    └── button-jump.png
```

### 特殊機能要件

1. **透過処理**
   - PNGファイルの白色（RGB > 240）を自動的に透明化
   - PreloadSceneで全アセットに適用

2. **パララックススクロール**
   - 背景がカメラの0.5倍速でスクロール

3. **カメラ追従**
   - プレイヤーを中心に追従
   - ワールド境界で停止

4. **衝突判定**
   - プレイヤー vs プラットフォーム
   - プレイヤー vs 敵（ダメージ処理）
   - プレイヤー vs アイテム（取得処理）
   - プレイヤー vs ゴール（ステージクリア）
   - 敵 vs 見えない壁（方向転換）

### パフォーマンス要件
- **FPS**: 60fps維持
- **レスポンシブ**: 画面サイズに応じて自動スケーリング
- **モバイル対応**: タッチ操作サポート

### 拡張可能性
- シーンベースの設計により新ステージ追加が容易
- 敵タイプ、アイテムタイプの追加が容易
- 設定値の外部化により難易度調整が容易

## 開発手順

1. プロジェクトセットアップ（Vite + React + TypeScript）
2. Phaser3統合
3. 基本シーン構造実装
4. アセット作成・読み込み処理
5. プレイヤーキャラクター実装
6. 敵キャラクター実装
7. ステージ1実装・テスト
8. ステージ2, 3実装
9. UI/HUD実装
10. タッチコントロール実装
11. 最終調整・デバッグ

## テスト要件
- 各ステージのクリア可能性確認
- 衝突判定の正確性
- スコア計算の正確性
- ライフシステムの動作確認
- モバイルでのタッチ操作確認
- 各種ブラウザでの動作確認